(function(){"use strict";function t(e,r){var o;if(!1==this instanceof t)throw new Error("new operator required");if("string"==typeof e){var n=e;e={},e.name=n,"string"==typeof r&&(e.type=r)}e=e||{},this.name=e.name||null,this.label=e.label||e.name,this.label&&(this.label=this.label.charAt(0).toUpperCase()+this.label.slice(1)),this.type=e.type||"String",o=function(t){var e=t.split("(");return e[1]=parseInt(e[1]),e}(this.type),this.type=o[0],this.hint=e.hint||{},this.validationRule=e.validationRule||{};var i=[],a=["name","type","label","hint","value","validationRule"];switch(this.type){case"ID":i=M(e,a),this.value=e.value||null;break;case"String":i=M(e,a.concat(["placeHolder","quickPick","size"])),this.size=o[1]?o[1]:"number"==typeof e.size?e.size:e.size||50,this.value=e.value||null,e.quickPick&&(this.quickPick=e.quickPick),this.placeHolder=e.placeHolder||null;break;case"Date":i=M(e,a.concat("placeHolder")),this.value=e.value||null,this.placeHolder=e.placeHolder||null;break;case"Boolean":i=M(e,a),e.value===!1?this.value=!1:this.value=e.value||null;break;case"Number":i=M(e,a.concat("placeHolder")),0===e.value?this.value=0:this.value=e.value||null,this.placeHolder=e.placeHolder||null;break;case"Model":i=M(e,a),this.value=e.value||null,this.value instanceof t.ModelID&&(this.modelType=this.value.modelType);break;case"Group":i=M(e,a),this.value=e.value||null;break;case"Table":i=M(e,a.concat("group")),this.value=e.value||null,this.group=e.group||null;break;case"Object":i=M(e,a),this.value=e.value||null}for(var s=this.getObjectStateErrors(),l=0;l<i.length;l++)s.push("invalid property: "+i[l]);if(s.length>1)throw new Error("error creating Attribute: multiple errors");if(s.length)throw new Error("error creating Attribute: "+s[0]);this._eventListeners=[],this._errorConditions={}}function e(t){if(!1==this instanceof e)throw new Error("new operator required");if("function"==typeof t){var r=t;t={type:"Function",contents:r}}t=t||{};var o,n=M(t,["name","description","type","contents","scope","timeout","theme","icon","bucket","presentationMode","location","images"]),i=[];for(o=0;o<n.length;o++)i.push("invalid property: "+n[o]);if(i.length>1)throw new Error("error creating Command: multiple errors");if(i.length)throw new Error("error creating Command: "+i[0]);for(o in t)this[o]=t[o];if(this.name=this.name||"a command","string"!=typeof this.name)throw new Error("name must be string");if("undefined"==typeof this.description&&(this.description=this.name+" Command"),"undefined"==typeof this.type&&(this.type="Stub"),!k(e.getTypes(),this.type))throw new Error("Invalid command type: "+this.type);switch(this.type){case"Stub":break;case"Menu":if(!(this.contents instanceof Array))throw new Error("contents must be array of menu items");if(!this.contents.length)throw new Error("contents must be array of menu items");for(o in this.contents)if(this.contents.hasOwnProperty(o)&&"string"!=typeof this.contents[o]&&!(this.contents[o]instanceof e))throw new Error("contents must be array of menu items");break;case"Presentation":if(!(this.contents instanceof y))throw new Error("contents must be a Presentation");if(this.presentationMode=this.presentationMode||"View",!k(e.getPresentationModes(),this.presentationMode))throw new Error("Invalid presentationMode: "+this.presentationMode);break;case"Function":if("function"!=typeof this.contents)throw new Error("contents must be a Function");break;case"Procedure":if(!(this.contents instanceof p))throw new Error("contents must be a Procedure");break;default:throw new TypeError}if("undefined"!=typeof this.scope&&!(this.scope instanceof d||this.scope instanceof u))throw new Error("optional scope property must be Model or List");if("undefined"!=typeof this.timeout&&"number"!=typeof this.timeout)throw new Error("timeout must be a Number");if("undefined"!=typeof this.timeout&&"number"!=typeof this.timeout)throw new Error("timeout must be a Number");if("undefined"!=typeof this.theme){if("string"!=typeof this.theme)throw new Error("invalid theme");if(!k(["default","primary","success","info","warning","danger","link"],this.theme))throw new Error("invalid theme")}if("undefined"!=typeof this.icon){if("string"!=typeof this.icon)throw new Error("invalid icon");if(!k(["fa","glyphicon"],this.icon.split("-")[0])||!this.icon.split("-")[1])throw new Error("invalid icon")}this._eventListeners=[]}function r(e){if(!1==this instanceof r)throw new Error("new operator required");if(!1==e instanceof t.ModelID)throw new Error("Attribute.ModelID required in constructor");this.dateCreated=new Date,this.modelID=e,this.attributeValues={}}function o(t){if(!1==this instanceof o)throw new Error("new operator required");t=t||{},t.name=t.name||"(unnamed)",t.description=t.description||"a Interface",t.vendor=t.vendor||null;var e,r=M(t,["name","description","vendor"]),n=[];for(e=0;e<r.length;e++)n.push("invalid property: "+r[e]);if(n.length>1)throw new Error("error creating Interface: multiple errors");if(n.length)throw new Error("error creating Interface: "+n[0]);this.startcallback=null,this.stopcallback=null,this.mocks=[],this.mockPending=!1;for(e in t)this[e]=t[e]}function n(t,e){if(!1==this instanceof n)throw new Error("new operator required");if("undefined"==typeof t)throw new Error("message type required");if(!k(n.getTypes(),t))throw new Error("Invalid message type: "+t);this.type=t,this.contents=e}function i(t){if(!1==this instanceof i)throw new Error("new operator required");if("string"==typeof t){var r=t;t={},t.type=r}if(t=t||{},this.type=t.type||null,t.value&&(this.value=t.value),!this.type||"string"!=typeof this.type)throw new Error("Request type required");switch(this.type){case"Command":if(this.command=t.command||null,!(this.command instanceof e))throw new Error("command object required")}}function a(t){if(!1==this instanceof a)throw new Error("new operator required");this.contents=t||"",this._eventListeners=[]}function s(t,e){if(!1==this instanceof s)throw new Error("new operator required");if("string"!=typeof t)throw new Error("argument must a url string");if("function"!=typeof e)throw new Error("argument must a callback");var r=this;r.connected=!1,r.initialConnect=!0,r.location=t,""===r.location&&(r.location="http host"),r.socket=io.connect(t,{reconnection:!1}),r.socket.on("connect",function(){r.connected=!0,r.initialConnect=!1,console.log("socket.io ("+r.location+") connected"),e.call(r,new n("Connected",""))}),r.socket.on("connecting",function(){console.log("socket.io ("+r.location+") connecting")}),r.socket.on("error",function(t){var o="general error with "+r.location+(t?", reason "+t:"");console.error(o),r.initialConnect&&e.call(r,new n("Error",o))}),r.socket.on("connect_error",function(t){var o="connect error with "+r.location+(t?", reason "+t:"");console.error(o),r.initialConnect&&e.call(r,new n("Error",o))}),r.socket.on("connect_failed",function(t){var o="connect failed with "+r.location+(t?", reason "+t:"");console.error(o),r.initialConnect&&e.call(r,new n("Error",o))}),r.socket.on("message",function(t){r.rawCallBack?r.rawCallBack(t):console.log("socket.io ("+r.location+") message: "+t)}),r.socket.on("disconnect",function(t){r.connected=!1,console.log("socket.io ("+r.location+") disconnect: "+t)})}function l(e){if(!1==this instanceof l)throw new Error("new operator required");e=e||{},e.attributes||(e.attributes=[]);var r=new t.ModelID(new b);e.attributes.push(new t({name:"user",type:"Model",value:r})),e.attributes.push(new t({name:"deltas",type:"Object",value:{}})),d.call(this,e),this.modelType="Workspace"}var c=this,h={CORE:function(){return{version:"0.4.25",Application:v,Attribute:t,Command:e,Delta:r,Interface:o,List:u,Log:g,MemoryStore:E,Message:n,Model:d,Presentation:y,Procedure:p,REPLInterface:m,Request:i,Session:w,Store:f,Text:a,Transport:s,User:b,Workspace:l,inheritPrototype:q,getInvalidProperties:M,getConstructorFromModelType:P,createModelFromModelType:C,trim:S,ltrim:x,rtrim:O,left:D,center:T,right:_,lpad:I,rpad:L,cpad:R,contains:k}}};t.ModelID=function(e){if(!1==this instanceof t.ModelID)throw new Error("new operator required");if(!1==e instanceof d)throw new Error("must be constructed with Model");var r=e.getShortName();r&&(this.name=r),this.value=e.get("id"),this.constructorFunction=e.constructor,this.modelType=e.modelType},t.ModelID.prototype.toString=function(){return this.name?this.modelType+" "+this.name:this.modelType+" "+this.value},t.prototype.toString=function(){return null===this.name?"new Attribute":"Attribute: "+this.name},t.prototype.onEvent=function(t,e){if(!(t instanceof Array)){if("string"!=typeof t)throw new Error("subscription string or array required");t=[t]}if("function"!=typeof e)throw new Error("callback is required");for(var r in t)if(t.hasOwnProperty(r)&&"*"!=t[r]&&!k(["StateChange","Validate"],t[r]))throw new Error("Unknown command event: "+t[r]);return this._eventListeners.push({events:t,callback:e}),this},t.prototype.offEvent=function(){this._eventListeners=[]},t.prototype._emitEvent=function(t){var e;for(e in this._eventListeners)if(this._eventListeners.hasOwnProperty(e)){var r=this._eventListeners[e];(r.events.length&&"*"===r.events[0]||k(r.events,t))&&r.callback.call(this,t)}},t.prototype.get=function(){return this.value},t.prototype.set=function(e){switch(this.type){case"Model":if(!(e instanceof t.ModelID))throw new Error("set error: value must be Attribute.ModelID");this.value=e;break;default:this.value=e}return this._emitEvent("StateChange"),this.value},t.prototype.coerce=function(t){var e,r=t;switch(this.type){case"String":return"undefined"==typeof r?"":"boolean"!=typeof r||r?r?(r=t.toString(),r.length>this.size?r.substring(0,this.size):r):"":"false";case"Number":return"undefined"==typeof r?0:r?("string"==typeof r?(r=r.replace(/^\s+|\s+$/g,""),e=r.split(" "),r=e.length?e[0]:"",r=Number(r.replace(/[^\/0-9\ \.]+/g,""))):r=Number(r),r?r:0):0;case"Boolean":return"undefined"==typeof r?!1:"string"==typeof r?(r=r.toUpperCase(),"Y"===r||"YES"===r||"T"===r||"TRUE"===r||"1"===r?!0:!1):r?!0:!1;case"Date":return"string"==typeof r&&2==r.split("/").length&&(r=r+"/"+(new Date).getFullYear()),new Date(r)}throw Error("coerce cannot determine appropriate value")},t.prototype.getObjectStateErrors=function(){var e;switch(this.validationErrors=[],this.name||this.validationErrors.push("name required"),k(["ID","String","Date","Boolean","Number","Model","Group","Table","Object"],this.type)||this.validationErrors.push("Invalid type: "+this.type),this.type){case"ID":break;case"String":"number"!=typeof this.size&&this.validationErrors.push("size must be a number from 1 to 255"),(this.size<1||this.size>255)&&this.validationErrors.push("size must be a number from 1 to 255"),null!==this.value&&"string"!=typeof this.value&&this.validationErrors.push("value must be null or a String");break;case"Date":null===this.value||this.value instanceof Date||this.validationErrors.push("value must be null or a Date");break;case"Boolean":null!==this.value&&"boolean"!=typeof this.value&&this.validationErrors.push("value must be null or a Boolean");break;case"Number":null!==this.value&&"number"!=typeof this.value&&this.validationErrors.push("value must be null or a Number");break;case"Model":this.value instanceof t.ModelID||this.validationErrors.push("value must be Attribute.ModelID");break;case"Group":if(null===this.value||this.value instanceof Array)for(e in this.value)this.value.hasOwnProperty(e)&&(this.value[e]instanceof t||this.validationErrors.push("each element in group must be instance of Attribute"),this.value[e].getObjectStateErrors().length&&this.validationErrors.push("group contains invalid members"));else this.validationErrors.push("value must be null or an array");break;case"Table":if(this.group instanceof t)if(this.group.value instanceof Array)if(this.group.value.length<1)this.validationErrors.push("group property value must contain at least one Attribute");else for(e in this.group.value)this.group.value.hasOwnProperty(e)&&(this.group.value[e]instanceof t||this.validationErrors.push("each element in group must be instance of Attribute"),this.group.value[e].getObjectStateErrors().length&&this.validationErrors.push("group contains invalid members"));else this.validationErrors.push("group.value must be an array");else this.validationErrors.push("group property required")}var r=M(this.validationRule,["required","range","isOneOf","isValidModel"]);return r.length&&this.validationErrors.push("invalid validationRule: "+r),this.validationMessage=this.validationErrors.length>0?this.validationErrors[0]:"",this.validationErrors},t.prototype.validate=function(t){if("function"!=typeof t)throw new Error("callback is required");this.getObjectStateErrors(),this._emitEvent("Validate");var e;for(e in this._errorConditions)this._errorConditions.hasOwnProperty(e)&&this.validationErrors.push(this._errorConditions[e]);this.validationRule.required&&!this.value&&("Number"==this.type?0!==this.value&&this.validationErrors.push(this.label+" required"):"Boolean"==this.type?this.value!==!1&&this.validationErrors.push(this.label+" required"):this.validationErrors.push(this.label+" required")),this.validationRule.range&&(this.validationRule.range instanceof Array||(this.validationRule.range=[this.validationRule.range]),(this.validationRule.range[0]||0===this.validationRule.range[0])&&this.value<this.validationRule.range[0]&&this.validationErrors.push(this.label+" must be at least "+this.validationRule.range[0]),(this.validationRule.range[1]||0===this.validationRule.range[1])&&this.value>this.validationRule.range[1]&&this.validationErrors.push(this.label+" must be no more than "+this.validationRule.range[1])),this.validationRule.isOneOf&&(this.validationRule.isOneOf instanceof Array||(this.validationRule.isOneOf=[this.validationRule.isOneOf]),-1==this.validationRule.isOneOf.indexOf(this.value)&&this.validationErrors.push(this.label+" invalid")),this.validationMessage=this.validationErrors.length>0?this.validationErrors[0]:"",this._emitEvent("StateChange"),t.call(this)},t.prototype.setError=function(t,e){if(t=t||"",e=e||"",!t)throw new Error("condition required");if(!e)throw new Error("description required");this._errorConditions[t]=e},t.prototype.clearError=function(t){if(t=t||"",!t)throw new Error("condition required");delete this._errorConditions[t]},t.getTypes=function(){return["ID","String","Date","Boolean","Number","Model","Group","Table","Object"].slice(0)},t.getEvents=function(){return["StateChange","Validate"].slice(0)},e.prototype.toString=function(){return this.type+" Command: "+this.name},e.prototype.onEvent=function(t,e){if(!(t instanceof Array)){if("string"!=typeof t)throw new Error("subscription string or array required");t=[t]}if("function"!=typeof e)throw new Error("callback is required");for(var r in t)if(t.hasOwnProperty(r)&&"*"!=t[r]&&!k(["BeforeExecute","AfterExecute","Error","Aborted","Completed"],t[r]))throw new Error("Unknown command event: "+t[r]);this._eventListeners.push({events:t,callback:e})},e.prototype._emitEvent=function(t,e){var r;for(r in this._eventListeners)if(this._eventListeners.hasOwnProperty(r)){var o=this._eventListeners[r];(o.events.length&&"*"===o.events[0]||k(o.events,t))&&o.callback.call(this,t,e)}},e.prototype.execute=function(t){function r(){s.status=0;try{s.contents.apply(s,l)}catch(t){s.error=t,s._emitEvent("Error",t),s._emitEvent("Completed"),s.status=-1}}function n(){s.status=0;for(var t=s.contents.tasks||[],r=0;r<t.length;r++){if("function"==typeof t[r]){var o=t[r];t[r]={requires:[-1],command:new e({type:"Function",contents:o})}}t[r].command._parentProcedure||(t[r].command._taskIndex=r,t[r].command._parentProcedure=s,t[r].command.onEvent("*",a)),t[r].command.status=void 0}i()}function i(){for(var t=s.contents.tasks||[],e=0;e<t.length;e++){var r=!0;if("undefined"==typeof t[e].command.status){for(var o in t[e].requires){if("string"==typeof t[e].requires[o])for(var n=0;n<t.length;n++)t[n].label==t[e].requires[o]&&(!t[n].command.status||t[n].command.status<=0)&&(r=!1);if("number"==typeof t[e].requires[o])if(-1==t[e].requires[o])"0"!=e&&(!t[e-1].command.status||t[e-1].command.status<=0)&&(r=!1);else{var i=t[e].requires[o];(!t[i].command.status||t[i].command.status<=0)&&(r=!1)}}r&&t[e].command.execute()}}}function a(t,e){var r=s.contents.tasks,o=!0;switch(t){case"Error":s._emitEvent("Error",e);break;case"Aborted":s.abort();break;case"Completed":for(var n in r)r.hasOwnProperty(n)&&(r[n].command.status&&0!==r[n].command.status||(o=!1));o?s.complete():i()}}var s=this,l=arguments;if(!s.type)throw new Error("command not implemented");if(!k(["Function","Procedure","Menu","Presentation"],s.type))throw new Error("command type "+s.type+" not implemented");var c;switch(s.type){case"Presentation":if(!(s.contents instanceof y))throw new Error("contents must be a Presentation");if(c=s.contents.getObjectStateErrors(),c.length)throw c.length>1?new Error("error executing Presentation: multiple errors"):new Error("error executing Presentation: "+c[0]);if(!(t instanceof o))throw new Error("interface param required")}s._emitEvent("BeforeExecute");try{switch(s.type){case"Function":setTimeout(r,0);break;case"Procedure":setTimeout(n,0);break;case"Menu":t.render(s,"View");break;case"Presentation":s.contents.preRenderCallback?s.contents.preRenderCallback(s,function(){t.render(s)}):t.render(s)}}catch(h){s.error=h,s._emitEvent("Error",h),s._emitEvent("Completed"),s.status=-1}s._emitEvent("AfterExecute")},e.prototype.abort=function(){this._emitEvent("Aborted"),this.status=-1,this._emitEvent("Completed")},e.prototype.complete=function(){this.status=1,this._emitEvent("Completed")},e.prototype.restart=function(){this.status=void 0,this._emitEvent("Restarted"),this.execute()},e.getTypes=function(){return["Stub","Menu","Presentation","Function","Procedure"].slice(0)},e.getEvents=function(){return["BeforeExecute","AfterExecute","Error","Aborted","Completed"].slice(0)},e.getPresentationModes=function(){return["View","Edit","List"].slice(0)},o.prototype.toString=function(){return this.description},o.prototype.canMock=function(){return!0},o.prototype.doMock=function(){var t,e;if(this.mockPending=!1,!(this.mocks.length<1)){var r=this.mocks.shift();if("ok"==r.type)return void(this.okcallback?(t=this.okcallback,delete this.okcallback,t()):this.okPending=!0);if("yes"==r.type||"no"==r.type||"cancel"==r.type){switch(r.type){case"yes":e=!0;break;case"no":e=!1;break;case"cancel":e=void 0}return void(this.yesnocallback?(t=this.yesnocallback,delete this.yesnocallback,t(e)):(this.yesnoPending=!0,this.yesnoResponse=e))}if("ask"==r.type)return void(this.askcallback?(t=this.askcallback,delete this.askcallback,t(r.value)):(this.askPending=!0,this.askResponse=r.value));if("choose"==r.type)return void(this.choosecallback?(t=this.choosecallback,delete this.choosecallback,t(o.firstMatch(r.value,this.chooseChoices))):(this.choosePending=!0,this.chooseResponse=r.value));this.dispatch(r),this.mockPending=!0;var n=this;setTimeout(function(){n.doMock()},0)}},o.prototype.mockRequest=function(t){if(!(t instanceof Array||t instanceof i))throw new Error("missing request parameter");t instanceof Array||(t=[t]);var e;for(e=0;e<t.length;e++)if(!1==t[e]instanceof i)throw new Error("invalid request parameter");for(e=0;e<t.length;e++)this.mocks.push(t[e]);this.mockPending||this.doMock()},o.prototype.start=function(t,e,r){if(!(t instanceof v))throw new Error("Application required");if(!(e instanceof y))throw new Error("presentation required");if("function"!=typeof r)throw new Error("callback required");this.application=t,this.presentation=e,this.startcallback=r},o.prototype.stop=function(t){if("function"!=typeof t)throw new Error("callback required")},o.prototype.dispatch=function(t,e){if(!1==t instanceof i)throw new Error("Request required");if(e&&"function"!=typeof e)throw new Error("response callback is not a function");this.application&&this.application.dispatch(t)||this.startcallback&&this.startcallback(t)},o.prototype.notify=function(t){if(!1==t instanceof n)throw new Error("Message required")},o.prototype.render=function(t,r){if(!1==t instanceof e)throw new Error("Command object required")},o.prototype.info=function(t){if(!t||"string"!=typeof t)throw new Error("text required")},o.prototype.done=function(t){if(!t||"string"!=typeof t)throw new Error("text required")},o.prototype.warn=function(t){if(!t||"string"!=typeof t)throw new Error("text required")},o.prototype.err=function(t){if(!t||"string"!=typeof t)throw new Error("text required")},o.prototype.ok=function(t,e){if(!t||"string"!=typeof t)throw new Error("prompt required");if("function"!=typeof e)throw new Error("callback required");this.okPending?(delete this.okPending,e()):this.okcallback=e},o.prototype.yesno=function(t,e){if(!t||"string"!=typeof t)throw new Error("prompt required");if("function"!=typeof e)throw new Error("callback required");this.yesnoPending?(delete this.yesnoPending,e(this.yesnoResponse)):this.yesnocallback=e},o.prototype.ask=function(e,r,o){if(!e||"string"!=typeof e)throw new Error("prompt required");if(!1==r instanceof t)throw new Error("attribute or callback expected");if("function"!=typeof o)throw new Error("callback required");this.askPending?(delete this.askPending,o(this.askResponse)):this.askcallback=o},o.prototype.choose=function(t,e,r){if(!t||"string"!=typeof t)throw new Error("prompt required");if(!1==e instanceof Array)throw new Error("choices array required");if(!e.length)throw new Error("choices array empty");if("function"!=typeof r)throw new Error("callback required");this.choosePending?(delete this.choosePending,r(o.firstMatch(this.chooseResponse,e))):(this.choosecallback=r,this.chooseChoices=e)},o.firstMatch=function(t,e){if(void 0!==t)for(var r=0;r<e.length;r++){var o=e[r].toLowerCase();if(D(o,t.length)==t.toLowerCase())return r}};var u=function(t){if(!1==this instanceof u)throw new Error("new operator required");if(!1==t instanceof d)throw new Error("argument required: model");this.model=t,this._items=[],this._itemIndex=-1};u.prototype.length=function(){return this._items.length},u.prototype.clear=function(){return this._items=[],this._itemIndex=-1,this},u.prototype.get=function(t){if(this._items.length<1)throw new Error("list is empty");for(var e=0;e<this.model.attributes.length;e++)if(this.model.attributes[e].name.toUpperCase()==t.toUpperCase())return"Date"!=this.model.attributes[e].type||this._items[this._itemIndex][e]instanceof Date?this._items[this._itemIndex][e]:new Date(this._items[this._itemIndex][e])},u.prototype.set=function(t,e){if(this._items.length<1)throw new Error("list is empty");for(var r=0;r<this.model.attributes.length;r++)if(this.model.attributes[r].name.toUpperCase()==t.toUpperCase())return void(this._items[this._itemIndex][r]=e);throw new Error("attribute not valid for list model")},u.prototype.addItem=function(t){var e,r=[];if(t)for(e in t.attributes)r.push(t.attributes[e].value);else for(e in this.model.attributes)r.push(void 0);return this._items.push(r),this._itemIndex=this._items.length-1,this},u.prototype.removeItem=function(){return this._items.splice(this._itemIndex,1),this._itemIndex--,this},u.prototype.findItemByID=function(t){for(var e=this.moveFirst();e;){if(t==this._items[this._itemIndex][0])return!0;e=this.moveNext()}return!1},u.prototype.indexedItem=function(t){return this._items.length<1?!1:0>t?!1:t>=this._items.length?!1:(this._itemIndex=t,!0)},u.prototype.moveNext=function(){return this._items.length<1?!1:this.indexedItem(this._itemIndex+1)},u.prototype.movePrevious=function(){return this._items.length<1?!1:this.indexedItem(this._itemIndex-1)},u.prototype.moveFirst=function(){return this._items.length<1?!1:this.indexedItem(0)},u.prototype.moveLast=function(){return this._items.length<1?!1:this.indexedItem(this._items.length-1)},u.prototype.sort=function(t){var e,r=0;for(var o in t)e||(e=o);if(!e)throw new Error("sort order required");for(var n=1==t[e];r<this.model.attributes.length&&this.model.attributes[r].name!=e;)r++;this._items.sort(function(t,e){if(n){if(t[r]<e[r])return-1;if(t[r]>e[r])return 1}else{if(t[r]>e[r])return-1;if(t[r]<e[r])return 1}return 0})};var d=function(e){var r;if(!1==this instanceof d)throw new Error("new operator required");if(this.modelType="Model",this.attributes=[new t("id","ID")],e=e||{},e.attributes)for(r in e.attributes)e.attributes.hasOwnProperty(r)&&this.attributes.push(e.attributes[r]);var o=M(e,["attributes"]),n=this.getObjectStateErrors();for(r=0;r<o.length;r++)n.push("invalid property: "+o[r]);if(n.length>1)throw new Error("error creating Model: multiple errors");if(n.length)throw new Error("error creating Model: "+n[0]);this._eventListeners=[],this._errorConditions={}};d._ModelConstructor={},d.prototype.toString=function(){return"a "+this.modelType},d.prototype.copy=function(t){for(var e=0;e<this.attributes.length;e++)this.attributes[e].value=t.attributes[e].value},d.prototype.getObjectStateErrors=function(){if(this.validationErrors=[],this.attributes instanceof Array)if(this.attributes.length<1)this.validationErrors.push("attributes must not be empty");else for(var e=0;e<this.attributes.length;e++)0!==e||this.attributes[e]instanceof t&&"ID"==this.attributes[e].type||this.validationErrors.push("first attribute must be ID"),this.attributes[e]instanceof t||this.validationErrors.push("attribute must be Attribute");else this.validationErrors.push("attributes must be Array");return void 0===this.tags||this.tags instanceof Array||this.validationErrors.push("tags must be Array or null"),this.validationErrors},d.prototype.get=function(t){for(var e=0;e<this.attributes.length;e++)if(this.attributes[e].name.toUpperCase()==t.toUpperCase())return this.attributes[e].get()},d.prototype.getShortName=function(){for(var t=0;t<this.attributes.length;t++)if("String"==this.attributes[t].type)return this.attributes[t].get();return""},d.prototype.getLongName=function(){return this.getShortName()},d.prototype.getAttributeType=function(t){for(var e=0;e<this.attributes.length;e++)if(this.attributes[e].name.toUpperCase()==t.toUpperCase())return this.attributes[e].type},d.prototype.set=function(t,e){for(var r=0;r<this.attributes.length;r++)if(this.attributes[r].name.toUpperCase()==t.toUpperCase())return this.attributes[r].set(e),void this._emitEvent("StateChange");throw new Error("attribute not valid for model")},d.prototype.validate=function(t){var e,r,o=this,n=0;if("function"!=typeof t)throw new Error("callback is required");o.getObjectStateErrors();for(r in o._errorConditions)o._errorConditions.hasOwnProperty(r)&&o.validationErrors.push(o._errorConditions[r]);if(o.validationErrors.length)return o.validationMessage=o.validationErrors.length>0?o.validationErrors[0]:"",o._emitEvent("StateChange"),void t.call(o);for(e=0;e<o.attributes.length;e++)n++,function(e){setTimeout(function(){e.validate(function(){e.validationErrors.length&&o.validationErrors.push("bush"),0===--n&&(o.validationErrors.length||o._emitEvent("Validate"),o.validationMessage=o.validationErrors.length>0?o.validationErrors[0]:"",o._emitEvent("StateChange"),t.call(o))})},0)}(o.attributes[e])},d.prototype.onEvent=function(t,e){if(!(t instanceof Array)){if("string"!=typeof t)throw new Error("subscription string or array required");t=[t]}if("function"!=typeof e)throw new Error("callback is required");for(var r in t)if(t.hasOwnProperty(r)&&"*"!=t[r]&&!k(["StateChange","Validate"],t[r]))throw new Error("Unknown command event: "+t[r]);return this._eventListeners.push({events:t,callback:e}),this},d.prototype._emitEvent=function(t,e){var r;for(r in this._eventListeners)if(this._eventListeners.hasOwnProperty(r)){var o=this._eventListeners[r];(o.events.length&&"*"===o.events[0]||k(o.events,t))&&o.callback.call(this,t,e)}},d.prototype.setError=function(t,e){if(t=t||"",e=e||"",!t)throw new Error("condition required");if(!e)throw new Error("description required");this._errorConditions[t]=e},d.prototype.clearError=function(t){if(t=t||"",!t)throw new Error("condition required");delete this._errorConditions[t]},n.prototype.toString=function(){switch(this.type){case"Null":return this.type+" Message";default:return this.type+" Message: "+this.contents}},n.getTypes=function(){return["Null","Connected","Error","Sent","Ping","PutModel","PutModelAck","GetModel","GetModelAck","DeleteModel","DeleteModelAck","GetList","GetListAck"].slice(0)};var p=function(t){if(!1==this instanceof p)throw new Error("new operator required");t=t||{};var e,r=M(t,["tasks","tasksNeeded","tasksCompleted"]),o=[];for(e=0;e<r.length;e++)o.push("invalid property: "+r[e]);if(o.length>1)throw new Error("error creating Procedure: multiple errors");if(o.length)throw new Error("error creating Procedure: "+o[0]);for(e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);if(o=this.getObjectStateErrors()){if(o.length>1)throw new Error("error creating Procedure: multiple errors");if(o.length)throw new Error("error creating Procedure: "+o[0])}};p.prototype.getObjectStateErrors=function(){var t,r,o,n;if(this.tasks&&!(this.tasks instanceof Array))return["tasks is not an array"];var i=[];for(t in this.tasks)if(this.tasks.hasOwnProperty(t)){var a=this.tasks[t];for(n=M(a,["label","command","requires","timeout"]),r=0;r<n.length;r++)i.push("invalid task["+t+"] property: "+n[r]);"undefined"!=typeof a.label&&"string"!=typeof a.label&&i.push("task["+t+"].label must be string"),"undefined"==typeof a.command||a.command instanceof e||i.push("task["+t+"].command must be a Command object"),"undefined"==typeof a.requires&&(a.requires=-1),a.requires instanceof Array||(a.requires=[a.requires]);for(r in a.requires)if(a.requires.hasOwnProperty(r)&&null!==a.requires[r])switch(typeof a.requires[r]){case"string":var s=!1;for(o=0;!s&&o<this.tasks.length;o++)a.requires[r]==this.tasks[o].label&&(s=!0);if(!s)throw new Error("missing label: "+a.requires[r]);break;case"number":if(a.requires[r]>=this.tasks.length)throw new Error("missing task #"+a.requires[r]+" for requires in task["+t+"]");if(a.requires[r]<-1)throw new Error("task #"+a.requires[r]+" invalid requires in task["+t+"]");break;default:throw new Error("invalid type for requires in task["+t+"]")}}return i.length?i:null},i.prototype.toString=function(){switch(this.type){case"Command":return this.type+" Request: "+this.command;default:return this.type+" Request"}};var f=function(t){if(!1==this instanceof f)throw new Error("new operator required");t=t||{},this.storeType=t.storeType||"Store",this.name=t.name||"a "+this.storeType,this.storeProperty={isReady:!1,canGetModel:!1,canPutModel:!1,canDeleteModel:!1,canGetList:!1};for(var e=M(t,["name","storeType"]),r=[],o=0;o<e.length;o++)r.push("invalid property: "+e[o]);if(r.length>1)throw new Error("error creating Store: multiple errors");if(r.length)throw new Error("error creating Store: "+r[0])};f.prototype.toString=function(){return this.name=="a "+this.storeType?this.name:this.storeType+": "+this.name},f.prototype.getServices=function(){return this.storeProperty},f.prototype.onConnect=function(t,e){if("string"!=typeof t)throw new Error("argument must a url string");if("function"!=typeof e)throw new Error("argument must a callback");e(this,void 0)},f.prototype.getModel=function(){throw new Error(this.storeType+" does not provide getModel")},f.prototype.putModel=function(){throw new Error("Store does not provide putModel")},f.prototype.deleteModel=function(){throw new Error("Store does not provide deleteModel")},f.prototype.getList=function(){throw new Error("Store does not provide getList")},a.prototype.toString=function(){return"Text: '"+(this.contents||"")+"'"},a.prototype.get=function(){return this.contents},a.prototype.set=function(t){return this.contents=t,this._emitEvent("StateChange"),this.contents},a.prototype._emitEvent=function(t){var e;for(e in this._eventListeners)if(this._eventListeners.hasOwnProperty(e)){var r=this._eventListeners[e];(r.events.length&&"*"===r.events[0]||k(r.events,t))&&r.callback.call(this,t)}},a.prototype.onEvent=function(t,e){if(!(t instanceof Array)){if("string"!=typeof t)throw new Error("subscription string or array required");
t=[t]}if("function"!=typeof e)throw new Error("callback is required");for(var r in t)if(t.hasOwnProperty(r)&&"*"!=t[r]&&!k(["StateChange"],t[r]))throw new Error("Unknown command event: "+t[r]);return this._eventListeners.push({events:t,callback:e}),this},a.prototype.offEvent=function(){this._eventListeners=[]},s.showLog=!1,s.messageHandlers={},s.setMessageHandler=function(t,e){s.messageHandlers[t]=e},s.hostMessageProcess=function(t,e){s.showLog&&console.log("Transport.hostMessageProcess "+JSON.stringify(t)),s.messageHandlers[t.type]?s.messageHandlers[t.type](t.contents,e):e(!0)},s.prototype.sendRaw=function(t){this.socket.send(t)},s.prototype.onRaw=function(t){this.rawCallBack=t},s.prototype.send=function(t,e){var r=this;if("undefined"==typeof t)throw new Error("message required");if(!(t instanceof n))throw new Error("parameter must be instance of Message");if("undefined"!=typeof e&&"function"!=typeof e)throw new Error("argument must a callback");return this.connected?void("undefined"!=typeof e?(s.showLog&&console.log("Transport emit "+JSON.stringify(t)),r.socket.emit("ackmessage",t,function(t){e.call(r,t)})):(s.showLog&&console.log("Transport send "+JSON.stringify(t)),r.socket.send(t))):void e.call(r,new n("Error","not connected"))},s.prototype.close=function(){if(!this.connected)throw new Error("not connected");this.socket.disconnect()};var m=function(t){if(!1==this instanceof o)throw new Error("new operator required");t=t||{},t.name=t.name||"(unnamed)",t.description=t.description||"a REPLInterface",t.vendor=t.vendor||null;var e,r=M(t,["name","description","vendor"]),n=[];for(e=0;e<r.length;e++)n.push("invalid property: "+r[e]);if(n.length>1)throw new Error("error creating Interface: multiple errors");if(n.length)throw new Error("error creating Interface: "+n[0]);this.startcallback=null,this.stopcallback=null,this.mocks=[],this.mockPending=!1,this.navStack=[];for(e in t)this[e]=t[e]};m.prototype=Object.create(o.prototype),m.prototype.toString=function(){return this.description},m.prototype.canMock=function(){return!0},m.prototype.doMock=function(){var t,e;if(this.mockPending=!1,!(this.mocks.length<1)){var r=this.mocks.shift();if("ok"==r.type)return void(this.okcallback?(t=this.okcallback,delete this.okcallback,t()):this.okPending=!0);if("yes"==r.type||"no"==r.type||"cancel"==r.type){switch(r.type){case"yes":e=!0;break;case"no":e=!1;break;case"cancel":e=void 0}return void(this.yesnocallback?(t=this.yesnocallback,delete this.yesnocallback,t(e)):(this.yesnoPending=!0,this.yesnoResponse=e))}if("ask"==r.type)return void(this.askcallback?(t=this.askcallback,delete this.askcallback,t(r.value)):(this.askPending=!0,this.askResponse=r.value));if("choose"==r.type)return void(this.choosecallback?(t=this.choosecallback,delete this.choosecallback,t(o.firstMatch(r.value,this.chooseChoices))):(this.choosePending=!0,this.chooseResponse=r.value));this.dispatch(r),this.mockPending=!0;var n=this;setTimeout(function(){n.doMock()},0)}},m.prototype.mockRequest=function(t){if(!(t instanceof Array||t instanceof i))throw new Error("missing request parameter");t instanceof Array||(t=[t]);var e;for(e=0;e<t.length;e++)if(!1==t[e]instanceof i)throw new Error("invalid request parameter");for(e=0;e<t.length;e++)this.mocks.push(t[e]);this.mockPending||this.doMock()},m.prototype.start=function(t,e,r){if(!(t instanceof v))throw new Error("Application required");if(!(e instanceof y))throw new Error("presentation required");if("function"!=typeof r)throw new Error("callback required");this.application=t,this.presentation=e,this.startcallback=r,this.evaluateInput()},m.prototype.stop=function(t){if("function"!=typeof t)throw new Error("callback required")},m.prototype.dispatch=function(t,e){if(!1==t instanceof i)throw new Error("Request required");if(e&&"function"!=typeof e)throw new Error("response callback is not a function");this.application&&this.application.dispatch(t)||this.startcallback&&this.startcallback(t)},m.prototype.notify=function(t){if(!1==t instanceof n)throw new Error("Message required");this._Output(t)},m.prototype.render=function(r,o,n){if(!1==r instanceof y)throw new Error("Presentation object required");if("string"!=typeof o)throw new Error("presentationMode required");if(!k(e.getPresentationModes(),o))throw new Error("Invalid presentationMode: "+o);if(n&&"function"!=typeof n)throw new Error("optional second argument must a commandRequest callback function");var i,a,s=r.get("contents"),l=0;switch(o){case"View":for(i=0;i<s.length;i++)s[i]instanceof t&&s[i].label.length>l&&(l=s[i].label.length);for(i=0;i<s.length;i++)a=s[i],a instanceof t?this._Output(I(a.label,l)+": "+a.value):this._Output(a);break;case"Edit":for(this.editPresentationContents=s.slice();this.editPresentationContents.length&&!(this.editPresentationContents[0]instanceof t);){var c=this.editPresentationContents.shift();c instanceof e||this._Output(c)}this.editPresentationContents.length&&this.editPresentationContents[0]instanceof t&&this._setPrompt(this.editPresentationContents[0].label+": "),this.editPresentationContents.length||delete this.editPresentationContents;break;default:throw new Error("presentationMode not handled: "+o)}},m.prototype.info=function(t){if(!t||"string"!=typeof t)throw new Error("text required");this._Output(t)},m.prototype.ok=function(t,e){if(!t||"string"!=typeof t)throw new Error("prompt required");if("function"!=typeof e)throw new Error("callback required");this._Output(t),this.okPending?(delete this.okPending,e()):this.okcallback=e},m.prototype.yesno=function(t,e){if(!t||"string"!=typeof t)throw new Error("prompt required");if("function"!=typeof e)throw new Error("callback required");this.yesnoPrompt=t,this._setPrompt(this.yesnoPrompt),this.yesnoPending?(delete this.yesnoPending,e(this.yesnoResponse)):this.yesnocallback=e},m.prototype.ask=function(e,r,o){if(!e||"string"!=typeof e)throw new Error("prompt required");if(!1==r instanceof t)throw new Error("attribute or callback expected");if("function"!=typeof o)throw new Error("callback required");this.askPrompt=e,this._setPrompt(e),this.askPending?(delete this.askPending,o(this.askResponse)):this.askcallback=o},m.prototype.choose=function(t,e,r){if(!t||"string"!=typeof t)throw new Error("prompt required");if(!1==e instanceof Array)throw new Error("choices array required");if(!e.length)throw new Error("choices array empty");if("function"!=typeof r)throw new Error("callback required");this.choosePrompt=t,this._Output(t);for(var n=0;n<e.length;n++)this._Output("  "+e[n]);this._setPrompt("Choice? "),this.choosePending?(delete this.choosePending,r(o.firstMatch(this.chooseResponse,e))):(this.choosecallback=r,this.chooseChoices=e)},m.prototype.evaluateInput=function(t){var e=this;void 0===t&&(t=""),this._evaluateInput(t),setTimeout(function(){var t=e.application?e.application.get("brand"):"?";!e.promptText&&e.application&&e.application.primaryInterface&&e._ShowNav(),e.promptText&&(t=e.promptText,delete e.promptText),e.capturePromptcallback&&e.capturePromptcallback(t)},10)},m.prototype._evaluateInput=function(r){var n,i,a,s=(""+r).toUpperCase();if(this.okcallback)return n=this.okcallback,delete this.okcallback,void n();if(this.yesnocallback)return"Y"==s||"YES"==s?(n=this.yesnocallback,delete this.yesnocallback,void n(!0)):"N"==s||"NO"==s?(n=this.yesnocallback,delete this.yesnocallback,void n(!1)):0===r.length?(n=this.yesnocallback,delete this.yesnocallback,void n()):(this._Output("yes or no response required"),void this._setPrompt(this.yesnoPrompt));if(this.askcallback)return n=this.askcallback,delete this.askcallback,void n(r);if(this.choosecallback){n=this.choosecallback;var l=o.firstMatch(r,this.chooseChoices);if(l)delete this.choosecallback,n(l);else if(r.length>0){for(this.application.info('"'+r+'" not valid'),this._Output(this.choosePrompt),i=0;i<this.chooseChoices.length;i++)this._Output("  "+this.chooseChoices[i]);this._setPrompt("Choice? ")}else delete this.choosecallback,n()}else{if(this.editPresentationContents){if(!(this.editPresentationContents.length&&this.editPresentationContents[0]instanceof t))throw this.editPresentationContents.length||delete this.editPresentationContents,new Error("editPresentationContents expected attribute");for(a=this.editPresentationContents.shift(),r.length&&(a.value=r);this.editPresentationContents.length&&!(this.editPresentationContents[0]instanceof t);)a=this.editPresentationContents.shift(),a instanceof e||this._Output(a);return this.editPresentationContents.length&&this.editPresentationContents[0]instanceof t&&this._setPrompt(this.editPresentationContents[0].label+": "),void(this.editPresentationContents.length||delete this.editPresentationContents)}if(this.presentation){var c=this.presentation.get("contents");if(this.navStack.length>0){var h=this.navStack[this.navStack.length-1];c=h.contents}for(i=0;i<c.length;i++){var u=c[i];if(u instanceof e){var d=u.name.toUpperCase();if(r.length&&D(d,s.length)==s){switch(u.type){case"Stub":this.info(u.description+" not available.");break;case"Menu":this.navStack.push(u);break;case"Presentation":u.presentationMode="Edit",u.execute(this);break;default:u.execute()}return}}}return void(r.length>0?this.application.info('"'+r+'" not valid'):this.navStack.pop())}this._Output("input ignored: "+r)}},m.prototype._ShowNav=function(){var t,r=this.application?this.application.get("brand"):"?",o=this.presentation.get("contents"),n="",i="",a="";if(this.navStack.length>0){var s=this.navStack[this.navStack.length-1];for(n=s.name.replace(/\s/g,"")+": ",o=s.contents,t=0;t<this.navStack.length;t++)r+=" / "+this.navStack[t].name.replace(/\s/g,"")}for(t=0;t<o.length;t++){var l=o[t];l instanceof e&&(i+=a+l.name.replace(/\s/g,""),a=", ")}this.application.info(n+i),this._setPrompt(r+">")},m.prototype.captureOutput=function(t){this.captureOutputcallback=t},m.prototype.capturePrompt=function(t){this.capturePromptcallback=t},m.prototype._setPrompt=function(t){this.promptText=t},m.prototype._Output=function(t){this.captureOutputcallback&&this.captureOutputcallback(t)};var v=function(e){if(!1==this instanceof v)throw new Error("new operator required");e=e||{},e.attributes||(e.attributes=[]),e.attributes.push(new t({name:"name",type:"String(20)"})),e.attributes.push(new t({name:"brand",type:"String"})),e["interface"]&&(this.setInterface(e["interface"]),delete e["interface"]),d.call(this,e),this.modelType="Application",this.set("name","newApp"),this.set("brand","NEW APP")};v.prototype=Object.create(d.prototype),d._ModelConstructor.Application=v,v.prototype.start=function(t){if(!1==this.primaryInterface instanceof o)throw new Error("error starting application: interface not set");if("function"!=typeof t)throw new Error("callback required");var e=this;this.startcallback=t,this.presentation||(this.presentation=new y),this.primaryInterface.start(e,this.presentation,function(t){"Command"==t.type?t.command.execute():e.startcallback&&e.startcallback(t)})},v.prototype.dispatch=function(t,e){if(!1==t instanceof i)throw new Error("Request required");if(e&&"function"!=typeof e)throw new Error("response callback is not a function");return"Command"==t.type?(t.command.execute(),!0):this.startcallback?(this.startcallback(t),!0):!1},v.prototype.setInterface=function(t){if(!1==t instanceof o)throw new Error("instance of Interface a required parameter");this.primaryInterface=t},v.prototype.getInterface=function(){return this.primaryInterface},v.prototype.setPresentation=function(t){if(!1==t instanceof y)throw new Error("instance of Presentation a required parameter");this.presentation=t},v.prototype.getPresentation=function(){return this.presentation},v.prototype.info=function(t){if(!1==this.primaryInterface instanceof o)throw new Error("interface not set");if(!t||"string"!=typeof t)throw new Error("text parameter required");this.primaryInterface.info(t)},v.prototype.done=function(t){if(!1==this.primaryInterface instanceof o)throw new Error("interface not set");if(!t||"string"!=typeof t)throw new Error("text parameter required");this.primaryInterface.done(t)},v.prototype.warn=function(t){if(!1==this.primaryInterface instanceof o)throw new Error("interface not set");if(!t||"string"!=typeof t)throw new Error("text parameter required");this.primaryInterface.warn(t)},v.prototype.err=function(t){if(!1==this.primaryInterface instanceof o)throw new Error("interface not set");if(!t||"string"!=typeof t)throw new Error("text parameter required");this.primaryInterface.err(t)},v.prototype.ok=function(t,e){if(!1==this.primaryInterface instanceof o)throw new Error("interface not set");if(!t||"string"!=typeof t)throw new Error("prompt required");if("function"!=typeof e)throw new Error("callback required");this.primaryInterface.ok(t,e)},v.prototype.yesno=function(t,e){if(!1==this.primaryInterface instanceof o)throw new Error("interface not set");if(!t||"string"!=typeof t)throw new Error("prompt required");if("function"!=typeof e)throw new Error("callback required");this.primaryInterface.yesno(t,e)},v.prototype.ask=function(e,r,n){if(!1==this.primaryInterface instanceof o)throw new Error("interface not set");if(!e||"string"!=typeof e)throw new Error("prompt required");if("function"==typeof r)return void this.primaryInterface.ask(e,new t({name:"default"}),r);if(!1==r instanceof t)throw new Error("attribute or callback expected");if("function"!=typeof n)throw new Error("callback required");this.primaryInterface.ask(e,r,n)},v.prototype.choose=function(t,e,r){if(!1==this.primaryInterface instanceof o)throw new Error("interface not set");if(!t||"string"!=typeof t)throw new Error("prompt required");if(!1==e instanceof Array)throw new Error("choices array required");if(!e.length)throw new Error("choices array empty");if("function"!=typeof r)throw new Error("callback required");this.primaryInterface.choose(t,e,r)};var g=function(e){if(!1==this instanceof g)throw new Error("new operator required");if("string"==typeof e){var r=e;e={},e.contents=r}e=e||{},e.attributes||(e.attributes=[]);var o=e.logType||"Text",n=e.importance||"Info",i=e.contents||"(no text)";if(!k(["Text","Delta"],o))throw new Error("Unknown log type: "+o);"undefined"!=typeof e.logType&&delete e.logType,"undefined"!=typeof e.importance&&delete e.importance,"undefined"!=typeof e.contents&&delete e.contents,e.attributes.push(new t({name:"dateLogged",type:"Date",value:new Date})),e.attributes.push(new t({name:"logType",type:"String",value:o})),e.attributes.push(new t({name:"importance",type:"String",value:n})),"Delta"==o?e.attributes.push(new t({name:"contents",type:"Object",value:i})):e.attributes.push(new t({name:"contents",type:"String",value:i})),d.call(this,e),this.modelType="Log"};g.prototype=Object.create(d.prototype),d._ModelConstructor.Log=g,g.prototype.toString=function(){return"Delta"==this.get("logType")?this.get("importance")+": (delta)":this.get("importance")+": "+this.get("contents")};var y=function(e){if(!1==this instanceof y)throw new Error("new operator required");e=e||{},e.attributes||(e.attributes=[]),e.attributes.push(new t({name:"name",type:"String"})),e.attributes.push(new t({name:"modelName",type:"String"})),e.attributes.push(new t({name:"contents",type:"Object",value:[]})),d.call(this,e),this.modelType="Presentation"};y.prototype=Object.create(d.prototype),d._ModelConstructor.Presentation=y,y.prototype.getObjectStateErrors=function(r){var o;if(this.validationErrors=d.prototype.getObjectStateErrors.call(this),!r&&0===this.validationErrors.length){var n=this.get("contents"),i=!1;if(n instanceof Array){for(o=0;o<n.length;o++)n[o]instanceof a||n[o]instanceof e||n[o]instanceof t||n[o]instanceof u||"string"==typeof n[o]||(i=!0);i&&this.validationErrors.push("contents elements must be Text, Command, Attribute, List or string")}else this.validationErrors.push("contents must be Array")}return this.validationMessage=this.validationErrors.length>0?this.validationErrors[0]:"",this.validationErrors},y.prototype.validate=function(e){function r(){c++,this.validationMessage&&(s=!0),l==c&&(s&&n.validationErrors.push("contents has validation errors"),o())}function o(){n.validationMessage=n.validationErrors.length>0?n.validationErrors[0]:"",e()}var n=this;if("function"!=typeof e)throw new Error("callback is required");this.getObjectStateErrors();var i;for(i in this._errorConditions)this._errorConditions.hasOwnProperty(i)&&this.validationErrors.push(this._errorConditions[i]);var a,s=!1,l=0,c=0,h=this.get("contents");for(h instanceof Array||(h=[]),a=0;a<h.length;a++)h[a]instanceof t&&l++;for(a=0;a<h.length;a++)h[a]instanceof t&&h[a].validate(r);h.length<1&&o()};var w=function(e){if(!1==this instanceof w)throw new Error("new operator required");e=e||{},e.attributes||(e.attributes=[]);var r=new t.ModelID(new b);e.attributes.push(new t({name:"userID",type:"Model",value:r})),e.attributes.push(new t({name:"dateStarted",type:"Date",value:new Date})),e.attributes.push(new t({name:"passCode",type:"String(20)"})),e.attributes.push(new t({name:"active",type:"Boolean"})),e.attributes.push(new t({name:"ipAddress",type:"String"})),d.call(this,e),this.modelType="Session",this.set("active",!1)};w.prototype=Object.create(d.prototype),d._ModelConstructor.Session=w,w.prototype.startSession=function(e,r,o,n,i){if(!1==e instanceof f)throw new Error("store required");if("string"!=typeof r)throw new Error("userName required");if("string"!=typeof o)throw new Error("password required");if("string"!=typeof n)throw new Error("ip required");if("function"!=typeof i)throw new Error("callback required");var a=this,s=new b;e.getList(new u(s),{name:r,password:o},function(r,o){if(o)return void i(o);if(1!=r.length())return void i(new Error("login not found"));for(var s="",l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",c=0;20>c;c++)s+=l.charAt(Math.floor(Math.random()*l.length));r.moveFirst(),r.model.set("id",r.get("id")),r.model.set("name",r.get("name")),a.set("userID",new t.ModelID(r.model)),a.set("active",!0),a.set("passCode",s),a.set("ipAddress",n),e.putModel(a,function(t,e){i(e,t)})})},w.prototype.resumeSession=function(t,e,r,o){if(!1==t instanceof f)throw new Error("store required");if("string"!=typeof e)throw new Error("ip required");if("string"!=typeof r)throw new Error("passCode required");if("function"!=typeof o)throw new Error("callback required");var n=this;t.getList(new u(n),{ipAddress:e,passCode:r},function(t,e){return e?void o(e):1!=t.length()?void o(new Error("session not resumed")):(t.moveFirst(),n.set("id",t.get("id")),n.set("userID",t.get("userID")),n.set("dateStarted",t.get("dateStarted")),n.set("passCode",t.get("passCode")),n.set("active",t.get("active")),n.set("ipAddress",t.get("ipAddress")),void o(e,n))})},w.prototype.endSession=function(t,e){if(!1==t instanceof f)throw new Error("store required");if("function"!=typeof e)throw new Error("callback required");this.get("active")&&this.get("id")||e(this),this.set("active",!1),t.putModel(this,function(t,r){e(r,t)})};var b=function(e){if(!1==this instanceof b)throw new Error("new operator required");e=e||{},e.attributes||(e.attributes=[]),e.attributes.push(new t({name:"name",type:"String(20)"})),e.attributes.push(new t({name:"active",type:"Boolean"})),e.attributes.push(new t({name:"password",type:"String(20)"})),e.attributes.push(new t({name:"firstName",type:"String(35)"})),e.attributes.push(new t({name:"lastName",type:"String(35)"})),e.attributes.push(new t({name:"email",type:"String(20)"})),d.call(this,e),this.modelType="User",this.set("active",!1)};b.prototype=Object.create(d.prototype),d._ModelConstructor.User=b,l.prototype=Object.create(d.prototype),d._ModelConstructor.Workspace=l;var E=function(t){if(!1==this instanceof E)throw new Error("new operator required");t=t||{},this.storeType=t.storeType||"MemoryStore",this.name=t.name||"a "+this.storeType,this.storeProperty={isReady:!0,canGetModel:!0,canPutModel:!0,canDeleteModel:!0,canGetList:!0},this.data=[],this.idCounter=0;for(var e=M(t,["name","storeType"]),r=[],o=0;o<e.length;o++)r.push("invalid property: "+e[o]);if(r.length>1)throw new Error("error creating Store: multiple errors");if(r.length)throw new Error("error creating Store: "+r[0])};E.prototype=Object.create(f.prototype),E.prototype.getModel=function(t,e){var r,o;if(!(t instanceof d))throw new Error("argument must be a Model");if(t.getObjectStateErrors().length)throw new Error("model has validation errors");if(!t.attributes[0].value)throw new Error("ID not set");if("function"!=typeof e)throw new Error("callback required");var n=-1;for(r=0;r<this.data.length;r++)this.data[r][0]==t.modelType&&(n=r);if(0>n)return void e(t,new Error("model not found in store"));var i=t.get("id"),a=this.data[n][1],s=-1;for(r=0;0>s&&r<a.length;r++)a[r][0]==i&&(s=r);if(0>s)return void e(t,new Error("id not found in store"));var l=a[s][1];for(o in t.attributes)t.attributes[o].value=l[t.attributes[o].name];e(t,void 0)},E.prototype.putModel=function(t,e){var r,o,n,i,a,s,l;if(!(t instanceof d))throw new Error("argument must be a Model");if(t.getObjectStateErrors().length)throw new Error("model has validation errors");if("function"!=typeof e)throw new Error("callback required");if(n=t.get("ID")){for(i=-1,r=0;r<this.data.length;r++)this.data[r][0]==t.modelType&&(i=r);if(0>i)return void e(t,new Error("model not found in store"));var c=-1;n=t.get("id");var h=this.data[i][1];for(r=0;0>c&&r<h.length;r++)h[r][0]==n&&(c=r);if(0>c)return void e(t,new Error("id not found in store"));a={};for(o in t.attributes)s=t.attributes[o].name,l=t.attributes[o].value,a[s]=l;h[c][1]=a,e(t,void 0)}else{for(i=-1,r=0;r<this.data.length;r++)this.data[r][0]==t.modelType&&(i=r);0>i&&(this.data.push([t.modelType,[]]),i=this.data.length-1);var u=++this.idCounter;t.set("id",u),a={};for(o in t.attributes)s=t.attributes[o].name,l=t.attributes[o].value,a[s]=l;this.data[i][1].push([u,a]),e(t,void 0)}},E.prototype.deleteModel=function(t,e){var r,o;if(!(t instanceof d))throw new Error("argument must be a Model");if(t.getObjectStateErrors().length)throw new Error("model has validation errors");if("function"!=typeof e)throw new Error("callback required");var n=-1;for(r=0;r<this.data.length;r++)this.data[r][0]==t.modelType&&(n=r);if(0>n)return void e(t,new Error("model not found in store"));var i=-1,a=t.get("id"),s=this.data[n][1];for(r=0;0>i&&r<s.length;r++)s[r][0]==a&&(i=r);if(0>i)return void e(t,new Error("id not found in store"));var l=s.splice(i,1)[0][1];for(o in t.attributes)"id"==t.attributes[o].name?t.attributes[o].value=void 0:t.attributes[o].value=l[t.attributes[o].name];e(t,void 0)},E.prototype.getList=function(t,e,r,o){var n,i,a;if("function"==typeof o?(n=o,i=r):n=r,!(t instanceof u))throw new Error("argument must be a List");if(!(e instanceof Object))throw new Error("filter argument must be Object");if("function"!=typeof n)throw new Error("callback required");var s=-1;for(a=0;a<this.data.length;a++)this.data[a][0]==t.model.modelType&&(s=a);if(0>s)return void n(t);t.clear();var l=this.data[s][1];for(a=0;a<l.length;a++){var c=!0;for(var h in e)e.hasOwnProperty(h)&&(e[h]instanceof RegExp?e[h].test(l[a][1][h])||(c=!1):e[h]!=l[a][1][h]&&(c=!1));if(c){var d=[];for(var p in l[a][1])d.push(l[a][1][p]);t._items.push(d)}}t._itemIndex=t._items.length-1,i&&t.sort(i),n(t)};var k=function(t,e){for(var r=0;r<t.length;r++)if(t[r]===e)return!0;return!1},q=function(t){function e(){}if(null===t)throw new TypeError;if(Object.create)return Object.create(t);var r=typeof t;if("object"!==r&&"function"!=typeof r)throw new TypeError;return e.prototype=t,new e},M=function(t,e){var r=[];for(var o in t)t.hasOwnProperty(o)&&(k(e,o)||r.push(o));return r},P=function(t){return d._ModelConstructor[t]||d},C=function(t){var e=P(t);return new e},D=function(t,e){return t.substring(0,e)},_=function(t,e){return t.substring(t.length-e,t.length)},T=function(t,e){var r=(t.length-e)/2;return t.substring(r,r+e)},S=function(t){return t.replace(/^\s+|\s+$/g,"")},x=function(t){return t.replace(/^\s+/,"")},O=function(t){return t.replace(/\s+$/,"")},I=function(t,e,r){r=r||" ";var o=""+t;if(o.length>e)return D(o,e);for(;o.length<e;)o=r+o;return o},L=function(t,e,r){r=r||" ";var o=""+t;if(o.length>e)return _(o,e);for(;o.length<e;)o+=r;return o},R=function(t,e,r){r=r||" ";var o=""+t,n=e-o.length;if(o.length>e)return T(o,e);var i=o.length+Math.floor(n/2);return o=I(o,i,r),o=L(o,e,r)};h.INTERFACE=h.INTERFACE||{},h.INTERFACE.BOOTSTRAP=function(){return{version:"0.1.5",BootstrapInterface:A}};var A=function(t){if(!1==this instanceof o)throw new Error("new operator required");t=t||{},t.name=t.name||"(unnamed)",t.description=t.description||"a BootstrapInterface",t.vendor=t.vendor||null;var e,r=M(t,["name","description","vendor"]),n=[];for(e=0;e<r.length;e++)n.push("invalid property: "+r[e]);if(n.length>1)throw new Error("error creating Interface: multiple errors");if(n.length)throw new Error("error creating Interface: "+n[0]);this.startcallback=null,this.stopcallback=null,this.mocks=[],this.mockPending=!1,this.doc={};for(e in t)this[e]=t[e]};A.prototype=Object.create(o.prototype),A.prototype.canMock=function(){return this.vendor?!0:!1},A.prototype.start=function(t,e,r){if(!(t instanceof v))throw new Error("Application required");if(!(e instanceof y))throw new Error("presentation required");if("function"!=typeof r)throw new Error("callback required");if(this.application=t,this.presentation=e,this.startcallback=r,!this.vendor)throw new Error("Error initializing Bootstrap");try{A._bs||(A._bs=new this.vendor)}catch(o){throw new Error("Error initializing Bootstrap: "+o)}this.htmlPanels(),this.htmlDialog(),this.presentation.get("contents").length&&this.htmlNavigation()},A.prototype.dispatch=function(t,e){if(!1==t instanceof i)throw new Error("Request required");if(e&&"function"!=typeof e)throw new Error("response callback is not a function");var r=!1;try{this.application&&("Command"==t.type&&"Presentation"==t.command.type?(t.command.execute(this),r=!0):r=this.application.dispatch(t)),!r&&this.startcallback&&this.startcallback(t)}catch(o){this.startcallback&&this.startcallback(o)}},A.prototype.render=function(t,r){if(!1==t instanceof e)throw new Error("Command object required");this.activatePanel(t)},A.addEle=function(t,e,r,o){var n=document.createElement(e);if(r&&r.length&&(n.className=r),o)for(var i in o)o.hasOwnProperty(i)&&n.setAttribute(i,o[i]);return t.appendChild(n),n},A.addTopEle=function(t,e,r,o){var n=document.createElement(e);if(r&&r.length&&(n.className=r),o)for(var i in o)o.hasOwnProperty(i)&&n.setAttribute(i,o[i]);return t.firstChild?t.insertBefore(n,t.firstChild):t.appendChild(n),n},A.prototype.htmlNavigation=function(){var t=A.addEle;this.doc.navBar=t(document.body,"nav","navbar navbar-default navbar-fixed-top");var e=t(this.doc.navBar,"div","container");this.doc.navBarHeader=t(e,"div","navbar-header");var r=t(this.doc.navBarHeader,"button","navbar-toggle collapsed",{"data-toggle":"collapse","data-target":"#navbar","aria-expanded":"false","aria-controls":"navbar"});t(r,"span","icon-bar"),t(r,"span","icon-bar"),t(r,"span","icon-bar"),this.doc.navBarBody=t(e,"div","navbar-collapse collapse",{id:"navbar"}),this.doc.navBarAlert=t(e,"div","container",{style:"margin:0"}),this.refreshNavigation()},A.prototype.refreshNavigation=function(){this.doc.navBarBody.innerHTML="";var t=A.addEle;this.doc.navBarLeft=t(this.doc.navBarBody,"ul","nav navbar-nav"),this.doc.navBarRight=t(this.doc.navBarBody,"ul","nav navbar-nav navbar-right"),t(this.doc.navBarHeader,"a","navbar-brand").innerHTML='<a href="#">'+this.application.get("brand")+"</a>";var e=this.presentation.get("contents"),r=!1;for(var o in e)if(e.hasOwnProperty(o))if("Menu"==e[o].type){var n=this.addNavBarListMenu(this.doc.navBarLeft,e[o].name),i=e[o].contents;for(var a in i)i.hasOwnProperty(a)&&this.addNavBarListItem(n,i[a])}else"-"==e[o]?r=!0:this.addNavigationItem(r?this.doc.navBarRight:this.doc.navBarLeft,e[o])},A.prototype.addNavigationItem=function(t,e){var r=this,o=A.addEle(t,"li"),n="",a=e.theme||"default";e.icon&&(n="fa"==D(e.icon,2)?'<i class="fa '+e.icon+'"></i>&nbsp;':'<span class="glyphicon '+e.icon+'"></span>&nbsp;'),o.innerHTML='<button type="button" class="btn btn-'+a+' navbar-btn">'+n+e.name+"</button>",$(o).click(function(t){r.dispatch(new i({type:"Command",command:e})),t.preventDefault()})},A.prototype.addNavBarListItem=function(t,r,o){var n,a=this,s=document.createElement("li");o=o||"",r instanceof e?(n="<a>"+o+r.name+"</a>",$(s).click(function(t){a.dispatch(new i({type:"Command",command:r})),t.preventDefault()})):"-"==r?s.className="divider":(s.className="dropdown-header",n=r),s.innerHTML=n,t.appendChild(s)},A.prototype.addNavBarListMenu=function(t,e){var r=document.createElement("li");r.className="dropdown",r.innerHTML='<button type="button" class="dropdown-toggle btn btn-default navbar-btn" data-toggle="dropdown">'+e+'&nbsp;<b class="caret"></b></button>',t.appendChild(r);var o=document.createElement("ul");return o.className="dropdown-menu",r.appendChild(o),o},A.prototype.htmlPanels=function(){var t=A.addEle;this.doc.mainContainer=t(document.body,"div","container main-container",{role:"main"}),this.doc.panelRow=t(this.doc.mainContainer,"div","row")},A.prototype.activatePanel=function(t){var e=this,r=A.addEle,o=A.addTopEle,n=t.contents,i=n.get("name")||t.name,a=t.theme||"default",s=t.icon;s&&(s="fa"==D(s,2)?'<i class="fa '+s+'"></i>&nbsp;':'<span class="glyphicon '+s+'"></span>&nbsp;');var l=s?s+i:i;"undefined"==typeof this.panels&&(this.panels=[]);for(var c,h=0;"undefined"==typeof c&&h<this.panels.length;h++)i==this.panels[h].name&&(c=this.panels[h]);"undefined"!=typeof c&&(e.destroyPanel(c),c=void 0),"undefined"==typeof c&&(c={name:i,listeners:[],attributeListeners:[],textListeners:[]},this.panels.push(c),c.panelDiv=o(this.doc.panelRow,"div","panel panel-"+a,{draggable:"true"}),c.panelHeading=r(c.panelDiv,"div","panel-heading"),c.panelTitle=r(c.panelHeading,"div","panel-title"),c.panelTitleText=r(c.panelTitle,"a","panel-title-text",{href:"#"}),c.panelTitleText.innerHTML=l,c.panelBody=r(c.panelDiv,"div","panel-body bg-"+a),c.panelWell=r(c.panelBody,"div","well-panel"),c.panelForm=r(c.panelWell,"form","form-horizontal"),c.panelClose=r(c.panelTitle,"a",void 0,{href:"#"}),c.panelClose.innerHTML='<span class="glyphicon glyphicon-remove panel-glyph-right pull-right text-muted"></span>',$(c.panelClose).click(function(t){e.destroyPanel(c),t.preventDefault()}),c.listeners.push(c.panelClose),c.panelHide=r(c.panelTitle,"a",void 0,{href:"#"}),c.panelHide.innerHTML='<span class="glyphicon glyphicon-chevron-down panel-glyph-right pull-right text-muted"></span>',$(c.panelHide).click(function(t){$(c.panelBody).hide("fast"),$(c.panelHide).hide(),$(c.panelShow).show(),t.preventDefault()}),c.listeners.push(c.panelHide),c.panelShow=r(c.panelTitle,"a",void 0,{href:"#"}),c.panelShow.innerHTML='<span class="glyphicon glyphicon-chevron-left panel-glyph-right pull-right text-muted"></span>',$(c.panelShow).hide(),$(c.panelShow).click(function(t){$(c.panelBody).show("fast"),$(c.panelHide).show(),$(c.panelShow).hide(),t.preventDefault()}),c.listeners.push(c.panelShow)),e.renderPanelBody(c,t),$(c.panelBody).show("fast"),$(c.panelHide).show(),$(c.panelShow).hide(),$("html, body").animate({scrollTop:$(c.panelDiv).offset().top-$(e.doc.navBar).height()-8},250)},A.prototype.destroyPanel=function(t){var e,r,o=this;for(e=0;e<o.panels.length;e++)t==o.panels[e]&&o.panels.splice(e,1);for(e=0;e<t.listeners.length;e++)r=t.listeners[e],$(r).off();for(e=0;e<t.attributeListeners.length;e++)r=t.attributeListeners[e],r.offEvent();for(e=0;e<t.textListeners.length;e++)r=t.textListeners[e],r.offEvent();$("html, body").stop(),$(t.panelDiv).remove()},A.prototype.renderPanelBody=function(r,o){function n(t){var e=m(r.panelForm,"div",v?"col-sm-offset-3":"");e.innerHTML=marked(t.get()),t.onEvent("StateChange",function(){e.innerHTML=marked(t.get())}),r.textListeners.push(t)}function s(t,e){function o(t){t?(c||(c=document.createElement("div"),c.className="col-sm-9 col-sm-offset-3 has-error",a.appendChild(c)),c.innerHTML='<span style="display: block;" class="help-block">'+t+"</span>",
$(a).addClass("has-error"),p&&$(p).addClass("btn-danger")):(setTimeout(function(){c&&($(c).remove(),c=null)},250),$(a).removeClass("has-error"),p&&$(p).removeClass("btn-danger"))}var n,i,a,s,l,c,h,u,d,p,f,v,g;switch(a=m(r.panelForm,"div","form-group"),m(a,"label","col-sm-3 control-label").innerHTML=t.label,h="1",t.size>2&&(h="2"),t.size>5&&(h="3"),t.size>10&&(h="4"),t.size>20&&(h="5"),t.size>25&&(h="6"),t.size>30&&(h="7"),t.size>40&&(h="8"),t.size>50&&(h="9"),"Number"==t.type&&(h="3"),"Date"==t.type&&(h="3"),"Boolean"==t.type&&(h="3"),s=m(a,"div","col-sm-"+h),e+t.type){case"ViewBoolean":l=m(s,"input","js-switch"),l.setAttribute("type","checkbox"),t.value&&l.setAttribute("checked","true"),v=new Switchery(l,{color:"#5bc0de",secondaryColor:"#dfdfdf",className:"switchery",disabled:!0,disabledOpacity:.5,speed:"0.1s"}),$(l).on("change",function(){t.value=l.checked});break;case"EditBoolean":l=m(s,"input","js-switch"),l.setAttribute("type","checkbox"),t.value&&l.setAttribute("checked","true"),v=new Switchery(l,{color:"#5bc0de",secondaryColor:"#dfdfdf",className:"switchery",disabled:!1,disabledOpacity:.5,speed:"0.1s"}),$(l).on("change",function(){t.value=l.checked});break;case"EditDate":u=m(s,"div","input-group date"),l=m(u,"input","form-control"),t.placeHolder&&l.setAttribute("placeHolder",t.placeHolder),t.value&&(l.value=1+t.value.getMonth()+"/"+t.value.getDate()+"/"+t.value.getFullYear()),d=m(u,"span","input-group-addon"),d.innerHTML='<i class="fa fa-calendar"></i>',$(u).datepicker({autoclose:!0,todayBtn:!0,todayHighlight:!0,showOnFocus:!1}).on("hide",function(t){y(),t.preventDefault()}),r.listeners.push(u);break;case"EditNumber":l=m(s,"input","form-control"),t.placeHolder&&l.setAttribute("placeHolder",t.placeHolder),l.setAttribute("type","number"),l.setAttribute("maxlength",t.size),l.setAttribute("value",t.value?t.value:0);break;case"EditString":if(t.quickPick?(u=m(s,"div","input-group"),l=m(u,"input","form-control")):l=m(s,"input","form-control"),t.placeHolder&&l.setAttribute("placeHolder",t.placeHolder),l.setAttribute("type",t.hint.password?"password":"text"),l.setAttribute("maxlength",t.size),t.value&&l.setAttribute("value",t.value),t.quickPick){for(d=m(u,"span","input-group-btn"),p=m(d,"button","btn btn-default dropdown-toggle"),p.type="button",p.setAttribute("data-toggle","dropdown"),p.innerHTML='<span class="caret"></span>',i=t.quickPick,n="",g=0;g<i.length;g++)n+='<li><a href="#">'+i[g]+"</a></li>";f=m(d,"ul","dropdown-menu pull-right"),f.innerHTML=n,$(f).click(function(t){l.value=t.originalEvent.srcElement.innerText,y(),t.preventDefault()}),r.listeners.push(f)}break;case"ViewDate":l=m(s,"p","form-control-static"),t.value&&(l.innerHTML=1+t.value.getMonth()+"/"+t.value.getDate()+"/"+t.value.getFullYear());break;default:l=m(s,"p","form-control-static"),l.innerHTML=t.value}var y=function(e){switch(t.type){case"Date":if(t.value=""===l.value?null:t.coerce(l.value),null!=t.value){var r=t.value.getMonth()+1,o=t.value.getDate(),n=t.value.getFullYear();10>r&&(r="0"+r),10>o&&(o="0"+o),l.value=r+"/"+o+"/"+n}else l.value="";break;default:t.value=""===l.value?null:t.coerce(l.value),null!=t.value&&(l.value=t.value)}t.validate(function(){})};$(l).on("focusout",y),r.listeners.push(l),t.onEvent("Validate",function(){t._validationDone=!0}),t.onEvent("StateChange",function(){switch(e+t.type){case"EditBoolean":t.value!=l.checked&&$(l).click();break;case"EditDate":l.value=t.value?""+(1+t.value.getMonth())+"/"+t.value.getDate()+"/"+t.value.getFullYear():"";break;case"EditNumber":l.value=t.value?t.value:0;break;case"EditString":l.value=t.value?""+t.value:"";break;case"ViewDate":l.innerHTML=t.value?""+(1+t.value.getMonth())+"/"+t.value.getDate()+"/"+t.value.getFullYear():"";break;default:l.innerHTML=t.value}o(t._validationDone?t.validationMessage:""),t._validationDone=!1}),r.attributeListeners.push(t)}function l(t,e){var o=document.createElement("table");o.className="table table-condensed table-bordered table-hover-"+e;var n=m(o,"thead"),i=m(n,"tr");for(d=1;d<t.model.attributes.length;d++){var a=t.model.attributes[d];m(i,"th").innerHTML=a.label}for(var s=t.moveFirst(),l=m(o,"tbody");s;){var c=m(l,"tr"),h=t.model.attributes[0];for($(c).data("id",t.get(h.name)),$(c).click(function(e){t.pickKludge&&t.pickKludge($(e.currentTarget).data("id")),e.preventDefault()}),d=1;d<t.model.attributes.length;d++){var u=t.model.attributes[d],p=t.get(u.name);switch(u.type){case"Date":m(c,"td").innerHTML=D(p.toISOString(),10);break;case"Boolean":p?m(c,"td").innerHTML='<i class="fa fa-check-square-o"></i>':m(c,"td").innerHTML='<i class="fa fa-square-o"></i>';break;default:p&&p.name?m(c,"td").innerHTML=p.name:m(c,"td").innerHTML=p}}s=t.moveNext()}r.panelForm.appendChild(o)}function c(t){if(!r.buttonDiv){var e=m(r.panelForm,"div","form-group");r.buttonDiv=m(e,"div",v?"col-sm-offset-3 col-sm-9":"col-sm-9")}var o=t.theme||"default",n=m(r.buttonDiv,"button","btn btn-"+o+" btn-presentation",{type:"button"}),a=t.icon;a?(a="fa"==D(a,2)?'<i class="fa '+a+'"></i>&nbsp;':'<span class="glyphicon '+a+'"></span>&nbsp;',n.innerHTML=a+t.name):n.innerHTML=t.name,$(n).on("click",function(e){e.preventDefault(),f.dispatch(new i({type:"Command",command:t}))}),r.listeners.push(n)}var h,d,p,f=this,m=A.addEle,v=!1,g=o.contents.get("contents");for(r.buttonDiv=null,$(r.panelForm).empty(),h=0;h<g.length;h++){if("string"==typeof g[h])switch(g[h]){case"-":r.panelForm.appendChild(document.createElement("hr"));break;case">":v=!0;break;case"<":v=!1;break;default:p=m(r.panelForm,"div",v?"col-sm-offset-3":""),p.innerHTML=marked(g[h])}g[h]instanceof a&&n(g[h]),g[h]instanceof t&&s(g[h],o.presentationMode),g[h]instanceof u&&l(g[h],o.theme),g[h]instanceof e&&c(g[h])}},A.prototype.htmlDialog=function(){var t,e,r,o,n,i,a,s,l,c,h=this,u=A.addEle;this.doc.okDialog=u(document.body,"div","modal fade",{tabindex:"-1",role:"dialog","aria-hidden":!0}),t=u(this.doc.okDialog,"div","modal-dialog"),e=u(t,"div","modal-content"),r=u(e,"div","modal-header",{style:"text-align: center"}),this.doc.okDialogTitle=u(r,"h4","modal-title",{style:"text-align: center"}),this.doc.okDialogBody=u(e,"div","modal-body",{style:"text-align: center"}),n=u(e,"div","modal-footer",{style:"text-align: center"}),i=u(n,"button","btn btn-primary"),i.innerHTML="&nbsp;&nbsp;OK&nbsp;&nbsp;",$(i).on("click",function(){$(h.doc.okDialog).modal("hide")}),$(this.doc.okDialog).on("hidden.bs.modal",function(t){if(h.okcallback){var e=h.okcallback;delete h.okcallback,e()}}),this.doc.yesnoDialog=u(document.body,"div","modal fade",{tabindex:"-1",role:"dialog","aria-hidden":!0}),t=u(this.doc.yesnoDialog,"div","modal-dialog"),e=u(t,"div","modal-content"),r=u(e,"div","modal-header",{style:"text-align: center"}),this.doc.yesnoDialogTitle=u(r,"h4","modal-title",{style:"text-align: center"}),this.doc.yesnoDialogBody=u(e,"div","modal-body",{style:"text-align: center"}),n=u(e,"div","modal-footer",{style:"text-align: center"}),s=u(n,"button","btn btn-success"),s.innerHTML="&nbsp;<u>Y</u>es&nbsp;",$(s).on("click",function(){$(h.doc.yesnoDialog).modal("hide"),h.yesnoResponse=!0}),l=u(n,"button","btn btn-danger"),l.innerHTML="&nbsp;<u>N</u>o&nbsp;&nbsp;",$(l).on("click",function(){$(h.doc.yesnoDialog).modal("hide"),h.yesnoResponse=!1}),$(this.doc.yesnoDialog).on("hidden.bs.modal",function(t){if(h.yesnocallback){var e=h.yesnocallback;delete h.yesnocallback,e(h.yesnoResponse)}}),this.doc.askDialog=u(document.body,"div","modal fade",{tabindex:"-1",role:"dialog","aria-hidden":!0}),t=u(this.doc.askDialog,"div","modal-dialog"),e=u(t,"div","modal-content"),r=u(e,"div","modal-header",{style:"text-align: center"}),this.doc.askDialogTitle=u(r,"h4","modal-title",{style:"text-align: center"}),o=u(e,"div","modal-body",{style:"text-align: center"}),this.doc.askDialogPrompt=u(o,"div","modal-body"),this.doc.askDialogInput=u(o,"input","form-control",{style:"margin:0 auto; width:80%;"}),$(this.doc.askDialogInput).keypress(function(t){13==t.which&&(h.askResponse=h.doc.askDialogInput.value,$(h.doc.askDialog).modal("hide"))}),n=u(e,"div","modal-footer",{style:"text-align: center"}),i=u(n,"button","btn btn-primary"),i.innerHTML="&nbsp;&nbsp;OK&nbsp;&nbsp;",$(i).on("click",function(){h.askResponse=h.doc.askDialogInput.value,$(h.doc.askDialog).modal("hide")}),a=u(n,"button","btn btn-default"),a.innerHTML="Cancel",$(a).on("click",function(){h.askResponse=void 0,$(h.doc.askDialog).modal("hide")}),$(this.doc.askDialog).on("hidden.bs.modal",function(t){if(h.askcallback){var e=h.askcallback;delete h.askcallback,e(h.askResponse)}}),$(this.doc.askDialog).on("shown.bs.modal",function(t){$(h.doc.askDialog).focus(),$(h.doc.askDialogInput).focus()}),this.doc.chooseDialog=u(document.body,"div","modal fade",{tabindex:"-1",role:"dialog","aria-hidden":!0}),t=u(this.doc.chooseDialog,"div","modal-dialog"),e=u(t,"div","modal-content"),r=u(e,"div","modal-header",{style:"text-align: center"}),this.doc.chooseDialogTitle=u(r,"h4","modal-title",{style:"text-align: center"}),o=u(e,"div","modal-body",{style:"text-align: center"}),this.doc.chooseDialogPrompt=u(o,"div","modal-body",{style:"text-align: center"}),this.doc.chooseDialogButtons=[],c=u(o,"button","btn btn-default btn-block"),$(c).on("click",function(){h.doc.chooseDialogChoice=0,$(h.doc.chooseDialog).modal("hide")}),this.doc.chooseDialogButtons.push(c),c=u(o,"button","btn btn-default btn-block"),$(c).on("click",function(){h.doc.chooseDialogChoice=1,$(h.doc.chooseDialog).modal("hide")}),this.doc.chooseDialogButtons.push(c),c=u(o,"button","btn btn-default btn-block"),$(c).on("click",function(){h.doc.chooseDialogChoice=2,$(h.doc.chooseDialog).modal("hide")}),this.doc.chooseDialogButtons.push(c),c=u(o,"button","btn btn-default btn-block"),$(c).on("click",function(){h.doc.chooseDialogChoice=3,$(h.doc.chooseDialog).modal("hide")}),this.doc.chooseDialogButtons.push(c),c=u(o,"button","btn btn-default btn-block"),$(c).on("click",function(){h.doc.chooseDialogChoice=4,$(h.doc.chooseDialog).modal("hide")}),this.doc.chooseDialogButtons.push(c),c=u(o,"button","btn btn-default btn-block"),$(c).on("click",function(){h.doc.chooseDialogChoice=5,$(h.doc.chooseDialog).modal("hide")}),this.doc.chooseDialogButtons.push(c),c=u(o,"button","btn btn-default btn-block"),$(c).on("click",function(){h.doc.chooseDialogChoice=6,$(h.doc.chooseDialog).modal("hide")}),this.doc.chooseDialogButtons.push(c),c=u(o,"button","btn btn-default btn-block"),$(c).on("click",function(){h.doc.chooseDialogChoice=7,$(h.doc.chooseDialog).modal("hide")}),this.doc.chooseDialogButtons.push(c),n=u(e,"div","modal-footer",{style:"text-align: center"}),a=u(n,"button","btn btn-default btn-block"),a.innerHTML='<b class="text-danger">Cancel</b>',$(a).on("click",function(){h.doc.chooseDialogChoice=void 0,$(h.doc.chooseDialog).modal("hide")}),$(this.doc.chooseDialog).on("hidden.bs.modal",function(t){if(h.choosecallback){var e=h.choosecallback;delete h.choosecallback,e(h.doc.chooseDialogChoices[h.doc.chooseDialogChoice])}})},A.prototype.info=function(t){var e=this,r=$.notify({icon:"glyphicon glyphicon-info-sign",title:"Information",message:t},{element:"body",position:null,type:"info",allow_dismiss:!0,newest_on_top:!0,placement:{from:"top",align:"right"},offset:{x:20,y:e.doc.navBarHeader.offsetHeight+20},spacing:10,z_index:1031,delay:0,timer:1e3,mouse_over:null,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"},onShow:null,onShown:null,onClose:null,onClosed:null,icon_type:"class",template:'<div data-notify="container" class="col-xs-11 col-sm-6 alert alert-notify alert-{0}" role="alert"><button type="button" aria-hidden="true" class="close" data-notify="dismiss"></button><h4><span data-notify="icon"></span> <span data-notify="title">{1}</span></h4><span data-notify="message">{2}</span><div class="progress" data-notify="progressbar"><div class="progress-bar progress-bar-{0}" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"></div></div></div>'});setTimeout(function(){r.close()},3e3)},A.prototype.done=function(t){var e=this,r=$.notify({icon:"glyphicon glyphicon-saved",title:"Done",message:t},{element:"body",position:null,type:"success",allow_dismiss:!0,newest_on_top:!0,placement:{from:"top",align:"right"},offset:{x:20,y:e.doc.navBarHeader.offsetHeight+20},spacing:10,z_index:1031,delay:0,timer:1e3,mouse_over:null,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"},onShow:null,onShown:null,onClose:null,onClosed:null,icon_type:"class",template:'<div data-notify="container" class="col-xs-11 col-sm-6 alert alert-notify alert-{0}" role="alert"><button type="button" aria-hidden="true" class="close" data-notify="dismiss"></button><h4><span data-notify="icon"></span> <span data-notify="title">{1}</span></h4><span data-notify="message">{2}</span><div class="progress" data-notify="progressbar"><div class="progress-bar progress-bar-{0}" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"></div></div></div>'});setTimeout(function(){r.close()},3e3)},A.prototype.warn=function(t){var e=this,r=$.notify({icon:"glyphicon glyphicon-exclamation-sign",title:"Warning",message:t},{element:"body",position:null,type:"warning",allow_dismiss:!0,newest_on_top:!0,placement:{from:"top",align:"right"},offset:{x:20,y:e.doc.navBarHeader.offsetHeight+20},spacing:10,z_index:1031,delay:0,timer:1e3,mouse_over:null,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"},onShow:null,onShown:null,onClose:null,onClosed:null,icon_type:"class",template:'<div data-notify="container" class="col-xs-11 col-sm-6 alert alert-notify alert-{0}" role="alert"><button type="button" aria-hidden="true" class="close" data-notify="dismiss"></button><h4><span data-notify="icon"></span> <span data-notify="title">{1}</span></h4><span data-notify="message">{2}</span><div class="progress" data-notify="progressbar"><div class="progress-bar progress-bar-{0}" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"></div></div></div>'});setTimeout(function(){r.close()},3e3)},A.prototype.err=function(t){var e=this,r=$.notify({icon:"glyphicon glyphicon-warning-sign",title:"Error",message:t},{element:"body",position:null,type:"danger",allow_dismiss:!0,newest_on_top:!0,placement:{from:"top",align:"right"},offset:{x:20,y:e.doc.navBarHeader.offsetHeight+20},spacing:10,z_index:1031,delay:0,timer:1e3,mouse_over:null,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"},onShow:null,onShown:null,onClose:null,onClosed:null,icon_type:"class",template:'<div data-notify="container" class="col-xs-11 col-sm-6 alert alert-notify alert-{0}" role="alert"><button type="button" aria-hidden="true" class="close" data-notify="dismiss"></button><h4><span data-notify="icon"></span> <span data-notify="title">{1}</span></h4><span data-notify="message">{2}</span><div class="progress" data-notify="progressbar"><div class="progress-bar progress-bar-{0}" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"></div></div></div>'});setTimeout(function(){r.close()},3e3)},A.prototype.ok=function(t,e){if(!t||"string"!=typeof t)throw new Error("prompt required");if("function"!=typeof e)throw new Error("callback required");this.okPending?(delete this.okPending,e()):(this.doc.okDialogTitle.innerHTML=this.application?this.application.get("brand"):"?",this.doc.okDialogBody.innerHTML=t,$(this.doc.okDialog).modal(),this.okcallback=e)},A.prototype.yesno=function(t,e){if(!t||"string"!=typeof t)throw new Error("prompt required");if("function"!=typeof e)throw new Error("callback required");this.yesnoPending?(delete this.yesnoPending,e(this.yesnoResponse)):(this.doc.yesnoDialogTitle.innerHTML=this.application.get("brand"),this.doc.yesnoDialogBody.innerHTML=t,$(this.doc.yesnoDialog).modal(),this.yesnocallback=e)},A.prototype.ask=function(e,r,o){if(!e||"string"!=typeof e)throw new Error("prompt required");if(!1==r instanceof t)throw new Error("attribute or callback expected");if("function"!=typeof o)throw new Error("callback required");this.askPending?(delete this.askPending,o(this.askResponse)):(this.doc.askDialogTitle.innerHTML=this.application.get("brand"),this.doc.askDialogPrompt.innerHTML=e+"<br><br>",$(this.doc.askDialog).modal(),this.askcallback=o)},A.prototype.choose=function(t,e,r){if(!t||"string"!=typeof t)throw new Error("prompt required");if(!1==e instanceof Array)throw new Error("choices array required");if(!e.length)throw new Error("choices array empty");if("function"!=typeof r)throw new Error("callback required");if(this.choosePending)delete this.choosePending,r(o.firstMatch(this.chooseResponse,e));else{if(e.length>this.doc.chooseDialogButtons.length)throw new Error("max choices reached in choose");this.doc.chooseDialogTitle.innerHTML=this.application.get("brand"),this.doc.chooseDialogPrompt.innerHTML=t.replace(/\n/g,"<br>"),$(this.doc.chooseDialog).modal(),this.choosecallback=r,this.doc.chooseDialogChoices=e;for(var n=0;n<this.doc.chooseDialogButtons.length;n++)n<e.length?(this.doc.chooseDialogButtons[n].innerHTML='<b class="text-primary">'+e[n]+"</b>",$(this.doc.chooseDialogButtons[n]).show()):$(this.doc.chooseDialogButtons[n]).hide()}},h.STORE=h.STORE||{},h.STORE.LOCALSTORAGE=function(){return{version:"0.0.4",LocalStore:H}};var H=function(t){if(!1==this instanceof H)throw new Error("new operator required");t=t||{},this.storeType=t.storeType||"LocalStore",this.name=t.name||"a "+this.storeType,this.storeProperty={isReady:!0,canGetModel:!0,canPutModel:!0,canDeleteModel:!0,canGetList:!0};for(var e=M(t,["name","storeType"]),r=[],o=0;o<e.length;o++)r.push("invalid property: "+e[o]);if(r.length>1)throw new Error("error creating Store: multiple errors");if(r.length)throw new Error("error creating Store: "+r[0])};H.prototype=Object.create(f.prototype),H.prototype.onConnect=function(t,e,r){if("string"!=typeof t)throw new Error("argument must a url string");if("function"!=typeof e)throw new Error("argument must a callback");r&&r.vendor&&(H.localStorage=r.vendor),e(this,void 0)},H.prototype.getModel=function(t,e){var r,o;if(!(t instanceof d))throw new Error("argument must be a Model");if(t.getObjectStateErrors().length)throw new Error("model has validation errors");if(!t.attributes[0].value)throw new Error("ID not set");if("function"!=typeof e)throw new Error("callback required");this._getStore();var n=-1;for(r=0;r<this.data.length;r++)this.data[r][0]==t.modelType&&(n=r);if(0>n)return void e(t,new Error("model not found in store"));var i=t.get("id"),a=this.data[n][1],s=-1;for(r=0;0>s&&r<a.length;r++)a[r][0]==i&&(s=r);if(0>s)return void e(t,new Error("id not found in store"));var l=a[s][1];for(o in t.attributes)t.attributes[o].value=l[t.attributes[o].name];e(t,void 0)},H.prototype.putModel=function(t,e){if(!(t instanceof d))throw new Error("argument must be a Model");if(t.getObjectStateErrors().length)throw new Error("model has validation errors");if("function"!=typeof e)throw new Error("callback required");this._getStore();var r=t.get("ID");if(r){for(var o=-1,n=0;n<this.data.length;n++)this.data[n][0]==t.modelType&&(o=n);if(0>o)return void e(t,new Error("model not found in store"));for(var i=-1,r=t.get("id"),a=this.data[o][1],n=0;0>i&&n<a.length;n++)a[n][0]==r&&(i=n);if(0>i)return void e(t,new Error("id not found in store"));var s={};for(var l in t.attributes){var c=t.attributes[l].name,h=t.attributes[l].value;s[c]=h}a[i][1]=s,this._putStore(),e(t,void 0)}else{for(var o=-1,n=0;n<this.data.length;n++)this.data[n][0]==t.modelType&&(o=n);0>o&&(this.data.push([t.modelType,[]]),o=this.data.length-1);var u=++this.idCounter;t.set("id",u);var s={};for(var l in t.attributes){var c=t.attributes[l].name,h=t.attributes[l].value;s[c]=h}this.data[o][1].push([u,s]),this._putStore(),e(t,void 0)}},H.prototype.deleteModel=function(t,e){if(!(t instanceof d))throw new Error("argument must be a Model");if(t.getObjectStateErrors().length)throw new Error("model has validation errors");if("function"!=typeof e)throw new Error("callback required");this._getStore();for(var r=-1,o=0;o<this.data.length;o++)this.data[o][0]==t.modelType&&(r=o);if(0>r)return void e(t,new Error("model not found in store"));for(var n=-1,i=t.get("id"),a=this.data[r][1],o=0;0>n&&o<a.length;o++)a[o][0]==i&&(n=o);if(0>n)return void e(t,new Error("id not found in store"));var s=a.splice(n,1)[0][1];for(var l in t.attributes)"id"==t.attributes[l].name?t.attributes[l].value=void 0:t.attributes[l].value=s[t.attributes[l].name];this._putStore(),e(t,void 0)},H.prototype.getList=function(t,e,r,o){var n,i;if("function"==typeof o?(n=o,i=r):n=r,!(t instanceof u))throw new Error("argument must be a List");if(!(e instanceof Object))throw new Error("filter argument must be Object");if("function"!=typeof n)throw new Error("callback required");this._getStore(),t.clear();for(var a=-1,s=0;s<this.data.length;s++)this.data[s][0]==t.model.modelType&&(a=s);if(0>a)return void n(t);for(var l=this.data[a][1],s=0;s<l.length;s++){var c=!0;for(var h in e)e.hasOwnProperty(h)&&(e[h]instanceof RegExp?e[h].test(l[s][1][h])||(c=!1):e[h]!=l[s][1][h]&&(c=!1));if(c){var d=[];for(var p in l[s][1])d.push(l[s][1][p]);t._items.push(d)}}t._itemIndex=t._items.length-1,i&&t.sort(i),n(t)},H.prototype._getStore=function(){H.localStorage.tequilaData?this.data=JSON.parse(H.localStorage.tequilaData):this.data=[],H.localStorage.tequilaIDCounter?this.idCounter=H.localStorage.tequilaIDCounter:this.idCounter=0},H.prototype._putStore=function(){H.localStorage.tequilaData=JSON.stringify(this.data),H.localStorage.tequilaIDCounter=this.idCounter},h.STORE=h.STORE||{},h.STORE.REMOTE=function(){return{version:"0.0.9",RemoteStore:B}};var B=function(t){if(!1==this instanceof B)throw new Error("new operator required");t=t||{},this.storeType=t.storeType||"RemoteStore",this.name=t.name||"a "+this.storeType,this.storeProperty={isReady:!1,canGetModel:!0,canPutModel:!0,canDeleteModel:!0,canGetList:!0};for(var e=M(t,["name","storeType"]),r=[],o=0;o<e.length;o++)r.push("invalid property: "+e[o]);if(r.length>1)throw new Error("error creating Store: multiple errors");if(r.length)throw new Error("error creating Store: "+r[0]);B.transport&&(this.storeProperty.isReady=!0,this.transport=B.transport)};B.prototype=Object.create(f.prototype),B.prototype.onConnect=function(t,e,r){if("string"!=typeof t)throw new Error("argument must a url string");if("function"!=typeof e)throw new Error("argument must a callback");var o=this;try{o.transport=new s(t,function(t){return"Error"==t.type?(console.log("Transport connect error: "+o.name),void e(void 0,new Error(t.contents))):"Connected"==t.type?(o.storeProperty.isReady=!0,B.transport=o.transport,void e(o)):(console.log("Transport unexpected message type: "+o.name),void e(void 0,new Error("unexpected message type: "+t.type)))})}catch(n){e(void 0,n)}},B.prototype.getModel=function(e,r){if(!(e instanceof d))throw new Error("argument must be a Model");if(e.getObjectStateErrors().length)throw new Error("model has validation errors");if(!e.attributes[0].value)throw new Error("ID not set");if("function"!=typeof r)throw new Error("callback required");this.transport.send(new n("GetModel",e),function(o){if("GetModelAck"==o.type){var n=o.contents;e.attributes=[];for(var i in n.attributes)if(n.attributes.hasOwnProperty(i)){var a=new t(n.attributes[i].name,n.attributes[i].type);a.value=n.attributes[i].value,e.attributes.push(a)}"string"==typeof n?r(e,n):r(e)}else r(e,Error(o))})},B.prototype.putModel=function(e,r){if(!(e instanceof d))throw new Error("argument must be a Model");if(e.getObjectStateErrors().length)throw new Error("model has validation errors");if("function"!=typeof r)throw new Error("callback required");this.transport.send(new n("PutModel",e),function(o){if("PutModelAck"==o.type){var n=o.contents;e.attributes=[];for(var i in n.attributes)if(n.attributes.hasOwnProperty(i)){var a;if("Model"==n.attributes[i].type){var s=C(n.attributes[i].modelType),l=new t.ModelID(s);l.value=n.attributes[i].value.value,n.attributes[i].value.name&&(l.name=n.attributes[i].value.name),a=new t({name:n.attributes[i].name,type:n.attributes[i].type,value:l})}else a=new t(n.attributes[i].name,n.attributes[i].type),a.value=n.attributes[i].value;e.attributes.push(a)}"string"==typeof n?r(e,n):r(e)}else r(e,Error(o))})},B.prototype.deleteModel=function(e,r){if(!(e instanceof d))throw new Error("argument must be a Model");if(e.getObjectStateErrors().length)throw new Error("model has validation errors");if("function"!=typeof r)throw new Error("callback required");this.transport.send(new n("DeleteModel",e),function(o){if("DeleteModelAck"==o.type){var n=o.contents;e.attributes=[];for(var i in n.attributes)if(n.attributes.hasOwnProperty(i)){var a=new t(n.attributes[i].name,n.attributes[i].type);a.value=n.attributes[i].value,e.attributes.push(a)}"string"==typeof n?r(e,n):r(e)}else r(e,Error(o))})},B.prototype.getList=function(t,e,r,o){var i,a;if("function"==typeof o?(i=o,a=r):i=r,!(t instanceof u))throw new Error("argument must be a List");if(!(e instanceof Object))throw new Error("filter argument must be Object");if("function"!=typeof i)throw new Error("callback required");for(var s in e)e.hasOwnProperty(s)&&(console.log("RemoteStore: before "+s+":"+e[s]),e[s]instanceof RegExp&&(e[s]=e[s].source,e[s]="RegExp:"+e[s]),console.log("RemoteStore: after "+s+":"+e[s]));this.transport.send(new n("GetList",{list:t,filter:e,order:a}),function(e){"GetListAck"==e.type?(t._items=e.contents._items,t._itemIndex=e.contents._itemIndex,i(t)):i(t,Error(e))})},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=h),exports.TGI=h):c.TGI=h}).call(this);